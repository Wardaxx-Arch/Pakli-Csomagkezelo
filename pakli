#!/bin/bash

# Yay telep√≠t≈ë f√ºggv√©ny
telepits_yay() {
    echo "üîß Yay telep√≠t√©se folyamatban..."
    sudo pacman -S --needed --noconfirm base-devel git
    git clone https://aur.archlinux.org/yay.git /tmp/yay
    cd /tmp/yay || { echo "‚ùå Nem siker√ºlt a yay k√∂nyvt√°rba l√©pni."; return 1; }
    makepkg -si --noconfirm || { echo "‚ùå A yay telep√≠t√©se sikertelen."; return 1; }
    cd - >/dev/null
    rm -rf /tmp/yay
    echo "‚úÖ Yay telep√≠tve."
}

# GitHub repo raw URL a legfrissebb verzi√≥hoz
GITHUB_RAW_URL="https://raw.githubusercontent.com/Wardaxx-Arch/Pakli-Csomagkezelo/main/pakli"

# Friss√≠t√©s ellen≈ërz≈ë √©s let√∂lt≈ë f√ºggv√©ny
frissites() {
    echo "üîç Friss√≠t√©s keres√©se a GitHubon..."
    # Let√∂ltj√ºk a GitHub verzi√≥t ideiglenesen
    curl -s -o /tmp/pakli_latest "$GITHUB_RAW_URL"
    if [ ! -s /tmp/pakli_latest ]; then
        echo "‚ùå Nem siker√ºlt let√∂lteni a friss√≠t√©st."
        return 1
    fi

    # √ñsszehasonl√≠tjuk az aktu√°lis f√°jllal
    if ! cmp -s "$0" /tmp/pakli_latest; then
        echo "‚¨ÜÔ∏è √öj verzi√≥ el√©rhet≈ë! Friss√≠t√©s telep√≠t√©se..."
        sudo cp /tmp/pakli_latest "$0"
        sudo chmod +x "$0"
        echo "‚úÖ Friss√≠t√©s k√©sz."
    else
        echo "‚úÖ M√°r a legfrissebb verzi√≥t haszn√°lod."
    fi

    rm /tmp/pakli_latest
}

if [ $# -eq 0 ]; then
    echo "Haszn√°lat: pakli [parancs] [csomagok]"
    echo "Haszn√°lhat√≥ parancsok: -Syu, -Ss, -S, -R, -Update, -h"
    exit 1
fi

case "$1" in
    -Syu)
        echo "üîÑ Rendszer friss√≠t√©se pacman-nel..."
        sudo pacman -Syu
        ;;

    -Ss)
        shift
        if [ $# -eq 0 ]; then
            echo "K√©rlek adj meg egy keres√©si kulcssz√≥t."
            exit 1
        fi
        pacman -Ss "$@" || yay -Ss "$@"
        ;;

    -S)
        shift
        if [ $# -eq 0 ]; then
            echo "K√©rlek adj meg legal√°bb egy csomagot a telep√≠t√©shez."
            exit 1
        fi
        echo "üì¶ Telep√≠tem: $@"
        if sudo pacman -S "$@"; then
            exit 0
        else
            if ! command -v yay >/dev/null 2>&1; then
                read -p "‚ö†Ô∏è Nem tal√°lhat√≥ yay csomagkezel≈ë. Telep√≠tsem? (y/n): " valasz
                if [[ "$valasz" =~ ^[Yy]$ ]]; then
                    telepits_yay || { echo "‚ùå Nem siker√ºlt a yay telep√≠t√©se."; exit 1; }
                else
                    echo "‚õî A yay nincs telep√≠tve, kil√©pek."
                    exit 1
                fi
            fi
            yay -S "$@"
        fi
        ;;

    -R)
        shift
        if [ $# -eq 0 ]; then
            echo "K√©rlek adj meg legal√°bb egy csomagot az elt√°vol√≠t√°shoz."
            exit 1
        fi
        echo "üóëÔ∏è Elt√°vol√≠tom: $@"
        sudo pacman -R "$@"
        ;;

    -Update)
        frissites
        ;;

    -h|--help)
        echo "Pakli - Egyszer≈± Arch alap√∫ csomagkezel≈ë"
        echo ""
        echo "Haszn√°lat:"
        echo "  pakli -Syu           Rendszer friss√≠t√©se"
        echo "  pakli -Ss keres≈ë     Csomag keres√©se"
        echo "  pakli -S csomagok    Csomag(ok) telep√≠t√©se"
        echo "  pakli -R csomagok    Csomag(ok) elt√°vol√≠t√°sa"
        echo "  pakli -Update        Pakli friss√≠t√©se a GitHubr√≥l"
        echo "  pakli -h             S√∫g√≥ megjelen√≠t√©se"
        ;;

    *)
        echo "Ismeretlen parancs: $1"
        echo "Haszn√°ld a -h opci√≥t a seg√≠ts√©g√©rt."
        exit 1
        ;;
esac
